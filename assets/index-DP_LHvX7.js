var y=Object.defineProperty;var L=(u,e,t)=>e in u?y(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t;var a=(u,e,t)=>L(u,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();const O={0:[6,13],1:[6,12],2:[6,11],3:[6,10],4:[6,9],5:[5,8],6:[4,8],7:[3,8],8:[2,8],9:[1,8],10:[0,8],11:[0,7],12:[0,6],13:[1,6],14:[2,6],15:[3,6],16:[4,6],17:[5,6],18:[6,5],19:[6,4],20:[6,3],21:[6,2],22:[6,1],23:[6,0],24:[7,0],25:[8,0],26:[8,1],27:[8,2],28:[8,3],29:[8,4],30:[8,5],31:[9,6],32:[10,6],33:[11,6],34:[12,6],35:[13,6],36:[14,6],37:[14,7],38:[14,8],39:[13,8],40:[12,8],41:[11,8],42:[10,8],43:[9,8],44:[8,9],45:[8,10],46:[8,11],47:[8,12],48:[8,13],49:[8,14],50:[7,14],51:[6,14],100:[7,13],101:[7,12],102:[7,11],103:[7,10],104:[7,9],105:[7,8],200:[1,7],201:[2,7],202:[3,7],203:[4,7],204:[5,7],205:[6,7],300:[7,1],301:[7,2],302:[7,3],303:[7,4],304:[7,5],305:[7,6],400:[13,7],401:[12,7],402:[11,7],403:[10,7],404:[9,7],405:[8,7],500:[1.5,10.58],501:[3.57,10.58],502:[1.5,12.43],503:[3.57,12.43],600:[1.5,1.58],601:[3.57,1.58],602:[1.5,3.45],603:[3.57,3.45],700:[10.5,1.58],701:[12.54,1.58],702:[10.5,3.45],703:[12.54,3.45],800:[10.5,10.58],801:[12.54,10.58],802:[10.5,12.43],803:[12.54,12.43]},E=6.66,d=["P1","P2","P3","P4"],g={P1:[500,501,502,503],P2:[600,601,602,603],P3:[700,701,702,703],P4:[800,801,802,803]},S={P1:0,P2:13,P3:26,P4:39},T={P1:[100,101,102,103,104],P2:[200,201,202,203,204],P3:[300,301,302,303,304],P4:[400,401,402,403,404]},f={P1:105,P2:205,P3:305,P4:405},p={P1:50,P2:11,P3:24,P4:37},C=[0,8,13,21,26,34,39,47],h={DICE_NOT_ROLLED:"DICE_NOT_ROLLED",DICE_ROLLED:"DICE_ROLLED"},m=document.querySelector("#dice-btn"),P={P1:document.querySelectorAll('[player-id="P1"].player-piece'),P2:document.querySelectorAll('[player-id="P2"].player-piece'),P3:document.querySelectorAll('[player-id="P3"].player-piece'),P4:document.querySelectorAll('[player-id="P4"].player-piece')},I=document.querySelector(".total-turns span");class r{static listenDiceClick(e){m.addEventListener("click",e),window.addEventListener("keydown",t=>{t.keyCode===13&&e()})}static listenResetClick(e){document.querySelector("button#reset-btn").addEventListener("click",e)}static listenPieceClick(e){document.querySelector(".player-pieces").addEventListener("click",e)}static setPiecePosition(e,t,i){if(!P[e]||!P[e][t]){console.error(`Player element of given player: ${e} and piece: ${t} not found`);return}const[s,n]=O[i],c=P[e][t];c.style.top=n*E+"%",c.style.left=s*E+"%"}static setTurn(e,t){if(e<0||e>=d.length){console.error("index out of bound!");return}const i=d[e];let s=i==="P1"?"P4":i==="P2"?"P1":i==="P3"?"P2":"P3";document.querySelector(".active-player span").innerText=i,document.querySelector(".last-player span").innerText=t==0?"-":s;const n=document.querySelector(".player-base.highlight");n&&n.classList.remove("highlight"),document.querySelector(`[player-id="${i}"].player-base`).classList.add("highlight")}static enableDice(){m.removeAttribute("disabled")}static disableDice(){m.setAttribute("disabled","")}static highlightPieces(e,t){t.forEach(i=>{P[e][i].classList.add("highlight")})}static unhighlightPieces(){document.querySelectorAll(".player-piece.highlight").forEach(e=>{e.classList.remove("highlight")})}static setDiceValue(e){document.querySelector(".dice-value").innerText=e}static incrementTotalTurns(e){I.innerHTML=e}static randomMoves(e,t){const i=document.querySelector(".active-player span").innerText,s=t[i].map(l=>l.toString().length<3||l.toString().length==3&&l.toString().substring(1)!="05"&&5-parseInt(l.toString().substring(2))>=e),n=s.findIndex(l=>l),c=s.findIndex(l=>!l);let o;if(m.click(),e===6&&(console.log("SIX"),console.log("not on board",c),c>=0)){o=c,console.log("PLAYER TO CLICK: ",o),P[i][o].click(),console.log(s);return}n>=0&&(o=n,console.log("PLAYER TO CLICK: ",o),P[i][o].click()),console.log(s),console.log("- - - - - - - - - - - - - - - - - - - -"),console.log(""),console.log(""),console.log("")}}class _{constructor(e){a(this,"currentPositions",{P1:[],P2:[],P3:[],P4:[]});a(this,"_diceValue");a(this,"_turn");a(this,"_state");a(this,"gameMode");this.gameMode=parseInt(e),console.log("Hello World! Lets play Ludo!"),console.log("Game mode:",this.gameMode),this.listenDiceClick(),this.listenResetClick(),this.listenPieceClick(),this.resetGame(),this.totalTurns=0,r.incrementTotalTurns(this.totalTurns),r.setTurn(0,this.totalTurns)}get diceValue(){return this._diceValue}set diceValue(e){this._diceValue=e,r.setDiceValue(e)}get turn(){return this._turn}set turn(e){this._turn=e,this.totalTurns++,r.incrementTotalTurns(this.totalTurns),r.setTurn(e,this.totalTurns)}get state(){return this._state}set state(e){this._state=e,e===h.DICE_NOT_ROLLED?(r.enableDice(),r.unhighlightPieces()):r.disableDice()}listenDiceClick(){r.listenDiceClick(this.onDiceClick.bind(this))}onDiceClick(){this.diceValue=1+Math.floor(Math.random()*6),this.state=h.DICE_ROLLED,this.checkForEligiblePieces()}checkForEligiblePieces(){const e=d[this.turn];let t;this.gameMode===0?(t=this.getEligiblePieces(e),t.length?r.highlightPieces(e,t):this.incrementTurn()):this.gameMode===1&&(t=[],d.forEach(i=>t.push(this.getEligiblePieces(i))),t.some(i=>i.length)?d.forEach((i,s)=>{r.highlightPieces(i,t[s]),console.log(i,s)}):this.incrementTurn()),console.log(t)}incrementTurn(){this.turn===3?this.turn=0:this.turn++,this.state=h.DICE_NOT_ROLLED}getEligiblePieces(e){return[0,1,2,3].filter(t=>{const i=this.currentPositions[e][t];return!(i===f[e]||g[e].includes(i)&&this.diceValue!==6||T[e].includes(i)&&this.diceValue>f[e]-i)})}listenResetClick(){r.listenResetClick(this.resetGame.bind(this))}resetGame(){console.log("reset game"),this.currentPositions=structuredClone(g),d.forEach(e=>{[0,1,2,3].forEach(t=>{this.setPiecePosition(e,t,this.currentPositions[e][t])})}),this.turn=0,this.state=h.DICE_NOT_ROLLED}listenPieceClick(){r.listenPieceClick(this.onPieceClick.bind(this))}onPieceClick(e){const t=e.target;if(!t.classList.contains("player-piece")||!t.classList.contains("highlight"))return;console.log("piece clicked");const i=t.getAttribute("player-id"),s=t.getAttribute("piece");this.handlePieceClick(i,s)}handlePieceClick(e,t){console.log(e,t);const i=this.currentPositions[e][t];if(g[e].includes(i)){this.setPiecePosition(e,t,S[e]),this.state=h.DICE_NOT_ROLLED;return}r.unhighlightPieces(),this.movePiece(e,t,this.diceValue)}setPiecePosition(e,t,i){this.currentPositions[e][t]=i,r.setPiecePosition(e,t,i)}movePiece(e,t,i){const s=setInterval(()=>{if(this.incrementPiecePosition(e,t),i--,i===0){if(clearInterval(s),this.hasPlayerWon(e)){alert(`Player: ${e} has won!`),this.resetGame();return}const n=this.checkForKill(e,t),c=this.currentPositions[e][t];if(this.diceValue===6||n||c===f[e]){this.state=h.DICE_NOT_ROLLED;return}this.incrementTurn()}},200)}checkForKill(e,t){const i=this.currentPositions[e][t];let s=[];for(let o=1;o<=4;o++)`P${o}`!=e?s.push(this.currentPositions[`P${o}`].some(l=>l===i)):s.push("");const n=`P${s.findIndex(o=>o)+1}`;console.log("isOpponentInPosition",s),console.log(n);let c=!1;return(n=="P1"||n=="P2"||n=="P3"||n=="P4")&&[0,1,2,3].forEach(o=>{const l=this.currentPositions[n][o];i===l&&!C.includes(i)&&(this.setPiecePosition(n,o,g[n][o]),c=!0)}),c}hasPlayerWon(e){return[0,1,2,3].every(t=>this.currentPositions[e][t]===f[e])}incrementPiecePosition(e,t){this.setPiecePosition(e,t,this.getIncrementedPosition(e,t))}getIncrementedPosition(e,t){const i=this.currentPositions[e][t];return i===p[e]?T[e][0]:i===51?0:i+1}}document.querySelectorAll(".mode").forEach(u=>{u.addEventListener("click",e=>{new _(u.getAttribute("mode")),document.querySelector(".choose-mode").style.display="none",document.querySelector(".ludo-container").style.display="block"})});
